<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ¸å¿ƒä»£ç å±•ç¤º - Format Specifications</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #3b82f6;
            --accent-color: #10b981;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-lighter: #334155;
            --text-light: #f1f5f9;
            --text-gray: #94a3b8;
            --border-color: #475569;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC',
                'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-light);
            line-height: 1.6;
            padding: 2rem;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.8s ease-out;
        }

        h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.25rem;
            color: var(--text-gray);
            margin-bottom: 1rem;
        }

        .badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--accent-color);
            border-radius: 9999px;
            color: var(--accent-color);
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* Navigation */
        nav {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
        }

        nav a {
            color: var(--text-light);
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--secondary-color);
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            display: inline-block;
        }

        nav a:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Section Styling */
        section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.8s ease-out;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .section-icon {
            font-size: 2.5rem;
        }

        h2 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-light);
        }

        h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 1.5rem 0 1rem;
            color: var(--secondary-color);
        }

        .location {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid #8b5cf6;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-family: 'Courier New', monospace;
            margin-bottom: 1rem;
        }

        /* Code Blocks */
        pre {
            background: #1a1a2e !important;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem !important;
            overflow-x: auto;
            margin: 1rem 0;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        code {
            font-family: 'Fira Code', 'Consolas', monospace;
        }

        /* Feature Cards */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .feature-card {
            background: var(--bg-lighter);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .feature-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .feature-title {
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
        }

        .feature-desc {
            font-size: 0.875rem;
            color: var(--text-gray);
        }

        /* Design Highlights */
        .highlight-box {
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid var(--accent-color);
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            border-radius: 0.5rem;
        }

        .highlight-box.warning {
            background: rgba(245, 158, 11, 0.1);
            border-left-color: #f59e0b;
        }

        .highlight-box.info {
            background: rgba(59, 130, 246, 0.1);
            border-left-color: var(--secondary-color);
        }

        .highlight-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Tech Stack */
        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .tech-item {
            background: var(--bg-lighter);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
        }

        .tech-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .tech-name {
            font-weight: 700;
            color: var(--primary-color);
        }

        .tech-desc {
            font-size: 0.875rem;
            color: var(--text-gray);
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Scroll to top button */
        .scroll-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--accent-color);
            color: white;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-lg);
            border: none;
            font-size: 1.5rem;
        }

        .scroll-top.visible {
            opacity: 1;
        }

        .scroll-top:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 3rem;
            padding: 2rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 1rem;
            color: var(--text-gray);
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            nav ul {
                flex-direction: column;
            }

            pre {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“š æ ¸å¿ƒä»£ç å±•ç¤ºä¸è¯´æ˜</h1>
            <p class="subtitle">Core Code Showcase and Documentation</p>
            <span class="badge">Format Specifications System</span>
        </header>

        <!-- Navigation -->
        <nav>
            <ul>
                <li><a href="#views">ğŸ¯ Django Views</a></li>
                <li><a href="#models">ğŸ’¾ Database Models</a></li>
                <li><a href="#ai">ğŸ¤– AI Processor</a></li>
                <li><a href="#formatter">ğŸ“ Word Formatter</a></li>
                <li><a href="#template">ğŸ“‹ Template Manager</a></li>
                <li><a href="#performance">âš¡ Performance</a></li>
                <li><a href="#techstack">ğŸ› ï¸ Tech Stack</a></li>
            </ul>
        </nav>

        <!-- Django Views Section -->
        <section id="views">
            <div class="section-header">
                <span class="section-icon">ğŸ¯</span>
                <h2>Django è§†å›¾å±‚ (Views)</h2>
            </div>
            <span class="location">format_specifications/views.py</span>

            <h3>1. ä¸»å…¥å£å‡½æ•° - AI æ ¼å¼åŒ–å¤„ç†</h3>
            <pre><code class="language-python">@require_http_methods(["POST"])
def ai_format_word(request):
    """
    ä¸»å…¥å£ï¼šå¤„ç†æ‰€æœ‰ä¼˜åŒ–æ¨¡å¼çš„è¯·æ±‚
    - simple: ç®€å•ä¼˜åŒ–ï¼ˆAI æ¶¦è‰² + æ ·å¼ç»Ÿä¸€ï¼‰
    - template: æ¨¡æ¿ç”Ÿæˆ
    - custom: è‡ªå®šä¹‰ç»“æ„
    """
    # 1. è·å–ä¼˜åŒ–æ¨¡å¼
    optimization_mode = request.POST.get('optimization_mode', 'simple')

    # 2. éªŒè¯æ–‡ä»¶ä¸Šä¼ 
    if 'word_file' not in request.FILES:
        return render(request, 'upload_word_ai.html', {
            'error': 'è¯·ä¸Šä¼  Word æ–‡ä»¶'
        })

    # 3. æ ¹æ®æ¨¡å¼è·¯ç”±åˆ°ä¸åŒçš„å¤„ç†å‡½æ•°
    if optimization_mode == 'simple':
        return handle_simple_optimization(request, uploaded_file)
    elif optimization_mode == 'template':
        return handle_template_optimization(request, uploaded_file)
    elif optimization_mode == 'custom':
        return handle_custom_optimization(request, uploaded_file)</code></pre>

            <div class="highlight-box">
                <div class="highlight-title">âœ¨ è®¾è®¡äº®ç‚¹</div>
                <ul>
                    <li><strong>æ¨¡å¼è·¯ç”±æ¨¡å¼</strong> - ç»Ÿä¸€å…¥å£ï¼Œæ ¹æ® optimization_mode åˆ†å‘</li>
                    <li><strong>æ–‡ä»¶éªŒè¯</strong> - ç¡®ä¿æ–‡ä»¶æ ¼å¼ä¸º .docx</li>
                    <li><strong>é”™è¯¯å¤„ç†</strong> - å‹å¥½çš„é”™è¯¯æç¤º</li>
                </ul>
            </div>

            <h3>2. ç®€å•ä¼˜åŒ–æ¨¡å¼å¤„ç†</h3>
            <pre><code class="language-python">def handle_simple_optimization(request, uploaded_file):
    """ç®€å•ä¼˜åŒ–æ¨¡å¼ï¼šAI æ¶¦è‰² + æ ·å¼ç»Ÿä¸€"""
    # è·å–é…ç½®
    use_ai = request.POST.get('use_ai') == 'on'
    tone = request.POST.get('tone', 'no_preference')
    style_template = request.POST.get('style_template', 'default')

    # è‡ªå®šä¹‰é…ç½®ï¼ˆæ”¯æŒå­—ä½“ã€å­—å·ã€è¡Œè·ã€å›¾ç‰‡å°ºå¯¸ï¼‰
    custom_config = {
        'heading_font': request.POST.get('heading_font'),
        'heading_size': request.POST.get('heading_size'),  # æ”¯æŒä¸­æ–‡ä»£ç 
        'body_font': request.POST.get('body_font'),
        'body_size': request.POST.get('body_size'),
        'line_spacing': safe_float(request.POST.get('line_spacing')),
        'image_width': image_width,
        'image_height': image_height,
    }

    # åˆå§‹åŒ–æ ¼å¼åŒ–å™¨
    formatter = AIWordFormatter(
        input_file_path,
        use_ai=use_ai,
        tone=tone,
        style_config=style_config,
        log_callback=log_callback
    )

    # æ‰§è¡Œæ ¼å¼åŒ–
    result = formatter.format(output_file_path)</code></pre>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”§</div>
                    <div class="feature-title">ä¸­æ–‡å­—å·æ”¯æŒ</div>
                    <div class="feature-desc">æ”¯æŒä¸­æ–‡ä»£ç ï¼ˆå¦‚ 'xiaosi'ï¼‰å’Œæ•°å€¼</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ–¼ï¸</div>
                    <div class="feature-title">å›¾ç‰‡å°ºå¯¸è‡ªå®šä¹‰</div>
                    <div class="feature-desc">æ”¯æŒè‹±å¯¸å’Œå˜ç±³å•ä½</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ“Š</div>
                    <div class="feature-title">æ—¥å¿—å›è°ƒ</div>
                    <div class="feature-desc">å®æ—¶å‘å‰ç«¯å‘é€å¤„ç†è¿›åº¦</div>
                </div>
            </div>
        </section>

        <!-- Database Models Section -->
        <section id="models">
            <div class="section-header">
                <span class="section-icon">ğŸ’¾</span>
                <h2>æ•°æ®åº“æ¨¡å‹ (Models)</h2>
            </div>
            <span class="location">format_specifications/models.py</span>

            <h3>æ–‡æ¡£æ¨¡æ¿æ¨¡å‹</h3>
            <pre><code class="language-python">class DocumentTemplate(models.Model):
    """
    æ–‡æ¡£æ¨¡æ¿æ¨¡å‹ï¼ˆæ”¯æŒç³»ç»Ÿæ¨¡æ¿å’Œç”¨æˆ·è‡ªå®šä¹‰æ¨¡æ¿ï¼‰
    """
    # æ¨¡æ¿ç±»å‹
    TEMPLATE_TYPE_CHOICES = [
        ('system', 'System Template'),
        ('user', 'User Template'),
    ]

    # åŸºæœ¬ä¿¡æ¯
    template_id = models.CharField(max_length=100, unique=True)
    name = models.CharField(max_length=200)
    description = models.TextField()
    category = models.CharField(max_length=100)

    # æ¨¡æ¿ç»“æ„ï¼ˆJSON æ ¼å¼å­˜å‚¨ï¼‰
    sections_json = models.JSONField(default=dict)

    # å…ƒæ•°æ®
    template_type = models.CharField(
        max_length=20,
        choices=TEMPLATE_TYPE_CHOICES,
        default='user'
    )
    created_by = models.ForeignKey(User, on_delete=models.CASCADE,
                                   null=True)
    version = models.CharField(max_length=20, default='1.0')
    is_active = models.BooleanField(default=True)

    # ä½¿ç”¨ç»Ÿè®¡
    usage_count = models.IntegerField(default=0)</code></pre>

            <div class="highlight-box info">
                <div class="highlight-title">ğŸ“¦ è®¾è®¡ç‰¹ç‚¹</div>
                <ul>
                    <li><strong>JSON å­˜å‚¨</strong> - çµæ´»å­˜å‚¨æ¨¡æ¿ç»“æ„</li>
                    <li><strong>åŒç±»å‹æ”¯æŒ</strong> - ç³»ç»Ÿæ¨¡æ¿ + ç”¨æˆ·æ¨¡æ¿</li>
                    <li><strong>ä½¿ç”¨ç»Ÿè®¡</strong> - è¿½è¸ªæ¨¡æ¿ä½¿ç”¨æ¬¡æ•°</li>
                    <li><strong>è½¯åˆ é™¤</strong> - is_active å­—æ®µæ”¯æŒè½¯åˆ é™¤</li>
                </ul>
            </div>
        </section>

        <!-- AI Processor Section -->
        <section id="ai">
            <div class="section-header">
                <span class="section-icon">ğŸ¤–</span>
                <h2>AI æ–‡æœ¬å¤„ç†å™¨ (AI Processor)</h2>
            </div>
            <span class="location">format_specifications/utils/ai_word_utils.py</span>

            <h3>1. ç¼“å­˜è£…é¥°å™¨ - é¿å…é‡å¤è°ƒç”¨</h3>
            <pre><code class="language-python">def cache_text_result(expire_seconds=30):
    """
    è£…é¥°å™¨ï¼šç¼“å­˜æ–‡æœ¬å¤„ç†ç»“æœï¼Œé¿å…é‡å¤è°ƒç”¨ AI æ¥å£
    """
    cache = {}

    def decorator(func):
        @wraps(func)
        def wrapper(self, raw_text, *args, **kwargs):
            # ç”Ÿæˆæ–‡æœ¬ç‰¹å¾å€¼ï¼ˆé¿å…é•¿æ–‡æœ¬ä½œä¸º keyï¼‰
            text_feature = f"{len(raw_text)}_{raw_text[:100]}"

            # æ£€æŸ¥ç¼“å­˜
            if text_feature in cache:
                cached_result, cached_time = cache[text_feature]
                if current_time - cached_time < expire_seconds:
                    return cached_result

            # æ‰§è¡ŒåŸæ–¹æ³•å¹¶ç¼“å­˜
            result = func(self, raw_text, *args, **kwargs)
            cache[text_feature] = (result, current_time)
            return result
        return wrapper
    return decorator</code></pre>

            <h3>2. é‡è¯•è£…é¥°å™¨ - æå‡å¯é æ€§</h3>
            <pre><code class="language-python">def retry_on_connection_error(max_retries=3, backoff_factor=2):
    """
    è£…é¥°å™¨ï¼šåœ¨è¿æ¥é”™è¯¯æ—¶é‡è¯•ï¼ˆæŒ‡æ•°é€€é¿ç­–ç•¥ï¼‰
    """
    def decorator(func):
        @wraps(func)
        def wrapper(self, *args, **kwargs):
            wait_time = 1

            for attempt in range(max_retries):
                try:
                    return func(self, *args, **kwargs)
                except (ConnectionError, Timeout) as e:
                    if attempt < max_retries - 1:
                        time.sleep(wait_time)
                        wait_time *= backoff_factor  # æŒ‡æ•°é€€é¿

            # æ‰€æœ‰é‡è¯•å¤±è´¥ï¼Œè¿”å›å…œåº•å€¼
            return raw_text if fallback_return == "raw_text" else ""
        return wrapper
    return decorator</code></pre>

            <h3>3. AI æ–‡æœ¬å¤„ç†æ ¸å¿ƒæ–¹æ³•</h3>
            <pre><code class="language-python">class AITextProcessor:
    def __init__(self, tone='no_preference', log_callback=None):
        """åˆå§‹åŒ– AI å¤„ç†å™¨"""
        self.api_key = settings.ZHIPU_API_KEY
        self.model = settings.ZHIPU_MODEL or "glm-4"
        self.client = ZhipuAI(api_key=self.api_key)
        self.request_timeout = 15  # è¶…æ—¶æ—¶é—´
        self.max_text_length = 1000  # æ–‡æœ¬é•¿åº¦é™åˆ¶

    @cache_text_result(expire_seconds=30)
    @retry_on_connection_error(max_retries=3, backoff_factor=2)
    def process_text(self, raw_text):
        """æ ¸å¿ƒæ–¹æ³•ï¼šè°ƒç”¨æ™ºè°± AI å®Œæˆæ–‡æœ¬æ¶¦è‰²"""
        # 1. å‰ç½®æ ¡éªŒ
        if not raw_text or len(raw_text) > self.max_text_length:
            return raw_text

        # 2. æ„å»ºæç¤ºè¯
        tone_instructions = self._get_tone_instruction()
        prompt = f"""{tone_instructions}
        è¯·æ¶¦è‰²ä»¥ä¸‹æ–‡å­—ï¼Œä½¿å…¶æ›´é€šé¡ºæ­£å¼ã€‚
        æ–‡å­—ï¼š{raw_text}"""

        # 3. è°ƒç”¨ AI æ¥å£
        response = self.client.chat.completions.create(
            model=self.model,
            messages=[
                {"role": "system", "content": "ä½ æ˜¯ä¸“ä¸šçš„æ–‡å­—å¤„ç†åŠ©æ‰‹"},
                {"role": "user", "content": prompt}
            ],
            temperature=0.3,
            max_tokens=2000,
            timeout=self.request_timeout
        )

        return response.choices[0].message.content.strip()</code></pre>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">âš¡</div>
                    <div class="feature-title">ç‰¹å¾å“ˆå¸Œ</div>
                    <div class="feature-desc">ä½¿ç”¨é•¿åº¦+å‰100å­—ç¬¦ä½œä¸ºç¼“å­˜é”®</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”„</div>
                    <div class="feature-title">è‡ªåŠ¨æ¸…ç†</div>
                    <div class="feature-desc">å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ“‰</div>
                    <div class="feature-title">æŒ‡æ•°é€€é¿</div>
                    <div class="feature-desc">é¿å…é›ªå´©æ•ˆåº”</div>
                </div>
            </div>
        </section>

        <!-- Word Formatter Section -->
        <section id="formatter">
            <div class="section-header">
                <span class="section-icon">ğŸ“</span>
                <h2>Word æ ¼å¼åŒ–å™¨ (Word Formatter)</h2>
            </div>
            <span class="location">format_specifications/utils/word_formatter.py</span>

            <h3>1. ä¸­æ–‡å­—å·æ˜ å°„è¡¨</h3>
            <pre><code class="language-python"># ä¸­æ–‡å­—å·æ˜ å°„è¡¨ï¼ˆä¸­æ–‡ä»£å· -> ç£…å€¼ï¼‰
CHINESE_FONT_SIZES = {
    'chuhao': 42,      # åˆå·
    'xiaochu': 36,     # å°åˆ
    'yihao': 26,       # ä¸€å·
    'xiaoyi': 24,      # å°ä¸€
    'erhao': 22,       # äºŒå·
    'xiaoer': 18,      # å°äºŒ
    'sanhao': 16,      # ä¸‰å·
    'xiaosan': 15,     # å°ä¸‰
    'sihao': 14,       # å››å·
    'xiaosi': 12,      # å°å››
    'wuhao': 10.5,     # äº”å·
    'xiaowu': 9,       # å°äº”
    # ä¹Ÿæ”¯æŒä¸­æ–‡å­—ç¬¦
    'åˆå·': 42, 'å°åˆ': 36, 'ä¸€å·': 26, ...
}</code></pre>

            <div class="highlight-box warning">
                <div class="highlight-title">ğŸ”¤ ç‰¹è‰²åŠŸèƒ½</div>
                <p><strong>åŒè¯­æ”¯æŒ</strong> - æ‹¼éŸ³ä»£ç ï¼ˆ'xiaosi'ï¼‰å’Œä¸­æ–‡å­—ç¬¦ï¼ˆ'å°å››'ï¼‰<br>
                <strong>è‡ªåŠ¨è½¬æ¢</strong> - ç»Ÿä¸€è½¬æ¢ä¸ºç£…å€¼</p>
            </div>

            <h3>2. æ ·å¼æ¨¡æ¿é…ç½®</h3>
            <pre><code class="language-python">STYLE_TEMPLATES = {
    'default': {
        'heading_font': 'é»‘ä½“',
        'heading_size': 22,
        'body_font': 'å®‹ä½“',
        'body_size': 12,
        'line_spacing': 1.5,
        'image_width': 5.91,
        'image_height': 4.43
    },
    'official': {
        'heading_font': 'é»‘ä½“',
        'body_font': 'ä»¿å®‹',  # å…¬æ–‡å¸¸ç”¨ä»¿å®‹
        'body_size': 14,
        'line_spacing': 1.5,
    },
    'academic': {
        'heading_font': 'é»‘ä½“',
        'body_font': 'å®‹ä½“',
        'line_spacing': 2.0,  # å­¦æœ¯è®ºæ–‡è¡Œè·è¾ƒå¤§
    },
    'casual': {
        'heading_font': 'å¾®è½¯é›…é»‘',
        'body_font': 'å¾®è½¯é›…é»‘',
        'line_spacing': 1.15,
    }
}</code></pre>

            <h3>3. AI å¤„ç†æ¨¡å¼ï¼ˆä¿ç•™å›¾ç‰‡ï¼‰</h3>
            <pre><code class="language-python">def _process_with_ai(self):
    """å¯ç”¨ AI æ—¶ï¼šä¿®å¤å›¾ç‰‡ä¸¢å¤± + æ€§èƒ½ä¼˜åŒ–"""
    # 1. æå–æ‰€æœ‰å›¾ç‰‡
    image_paths = self._extract_images_from_docx()

    # 2. æ£€æµ‹å›¾ç‰‡æ®µè½å’Œæ–‡æœ¬æ®µè½
    image_para_indices = []
    pure_texts = []

    for idx, para in enumerate(original_paragraphs):
        para_xml = para._element.xml
        has_image = '<w:drawing>' in para_xml or '<pic:pic>' in para_xml

        if has_image:
            image_para_indices.append(idx)
        elif para.text.strip():
            pure_texts.append(para.text.strip())

    # 3. AI å¤„ç†æ–‡æœ¬
    processed_text = self.ai_processor.process_text(merged_text)
    processed_text_blocks = processed_text.split("\n\n")

    # 4. é‡å»ºæ–‡æ¡£ï¼ˆæŒ‰åŸå§‹é¡ºåºæ’å…¥å›¾ç‰‡ï¼‰
    new_doc = Document()
    for original_para_idx, para in enumerate(original_paragraphs):
        if original_para_idx in image_para_indices:
            # æ’å…¥å›¾ç‰‡
            img_run.add_picture(image_paths[img_idx],
                               width=self.image_width,
                               height=self.image_height)
        elif original_para_idx in text_para_indices:
            # æ’å…¥ AI å¤„ç†åçš„æ–‡æœ¬
            text_para = new_doc.add_paragraph(
                processed_text_blocks[text_idx]
            )</code></pre>

            <div class="highlight-box">
                <div class="highlight-title">ğŸ–¼ï¸ æ ¸å¿ƒç®—æ³•</div>
                <ul>
                    <li><strong>å›¾ç‰‡å®šä½</strong> - è§£æ XML æ£€æµ‹å›¾ç‰‡æ®µè½</li>
                    <li><strong>é¡ºåºé‡å»º</strong> - ä¿æŒåŸå§‹å›¾æ–‡é¡ºåº</li>
                    <li><strong>æ™ºèƒ½é‡å»º</strong> - AI å¤„ç†åæ–‡æœ¬å¯èƒ½åˆ†å¤šæ®µ</li>
                </ul>
            </div>
        </section>

        <!-- Template Manager Section -->
        <section id="template">
            <div class="section-header">
                <span class="section-icon">ğŸ“‹</span>
                <h2>æ¨¡æ¿ç®¡ç†å™¨ (Template Manager)</h2>
            </div>
            <span class="location">format_specifications/services/template_manager.py</span>

            <pre><code class="language-python">class TemplateManager:
    @staticmethod
    def get_template(template_id: str, user: User = None):
        """
        è·å–æ¨¡æ¿ï¼ˆä¼˜å…ˆé¢„å®šä¹‰æ¨¡æ¿ï¼Œç„¶åæŸ¥è¯¢æ•°æ®åº“ï¼‰
        """
        # 1. å…ˆæ£€æŸ¥é¢„å®šä¹‰æ¨¡æ¿
        if template_id in PREDEFINED_TEMPLATES:
            return PREDEFINED_TEMPLATES[template_id]

        # 2. å†æ£€æŸ¥æ•°æ®åº“ä¸­çš„ç”¨æˆ·æ¨¡æ¿
        try:
            db_template = DocumentTemplate.objects.get(
                template_id=template_id,
                created_by=user,
                is_active=True
            )
            return db_template.to_template_definition()
        except DocumentTemplate.DoesNotExist:
            return None</code></pre>

            <div class="highlight-box info">
                <div class="highlight-title">ğŸ“‹ è®¾è®¡æ¨¡å¼</div>
                <p><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong> - ä¼˜å…ˆçº§æŸ¥æ‰¾ï¼ˆé¢„å®šä¹‰ > æ•°æ®åº“ï¼‰<br>
                <strong>å·¥å‚æ¨¡å¼</strong> - ç»Ÿä¸€è¿”å› TemplateDefinition å¯¹è±¡</p>
            </div>
        </section>

        <!-- Performance Section -->
        <section id="performance">
            <div class="section-header">
                <span class="section-icon">âš¡</span>
                <h2>æ€§èƒ½ä¼˜åŒ–æ€»ç»“</h2>
            </div>

            <h3>1. AI è°ƒç”¨ä¼˜åŒ–</h3>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ’¾</div>
                    <div class="feature-title">ç¼“å­˜æœºåˆ¶</div>
                    <div class="feature-desc">ç›¸åŒæ–‡æœ¬ 30 ç§’å†…ä¸é‡å¤è°ƒç”¨</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ“¦</div>
                    <div class="feature-title">æ‰¹é‡å¤„ç†</div>
                    <div class="feature-desc">å°æ–‡æ¡£ä¸€æ¬¡æ€§ç”Ÿæˆæ‰€æœ‰ç« èŠ‚</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">â±ï¸</div>
                    <div class="feature-title">è¶…æ—¶æ§åˆ¶</div>
                    <div class="feature-desc">15 ç§’è¶…æ—¶é¿å…æ— é™ç­‰å¾…</div>
                </div>
            </div>

            <h3>2. æ–‡æ¡£å¤„ç†ä¼˜åŒ–</h3>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ“</div>
                    <div class="feature-title">ä¸´æ—¶ç›®å½•</div>
                    <div class="feature-desc">è¾“å…¥æ–‡ä»¶åŒç›®å½•ï¼Œé¿å…æƒé™é—®é¢˜</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">âœï¸</div>
                    <div class="feature-title">æ‰‹åŠ¨å†™å…¥</div>
                    <div class="feature-desc">æ›¿ä»£ zip.extractï¼Œæå‡æ€§èƒ½</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ–¼ï¸</div>
                    <div class="feature-title">å›¾ç‰‡é¢„æå–</div>
                    <div class="feature-desc">å…ˆæå–åå¤„ç†ï¼Œä¿æŒé¡ºåº</div>
                </div>
            </div>

            <h3>3. ç½‘ç»œä¼˜åŒ–</h3>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”„</div>
                    <div class="feature-title">çŠ¶æ€è½®è¯¢</div>
                    <div class="feature-desc">è½»é‡çº§ session è¯»å–ï¼Œå“åº” &lt; 10ms</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ“‰</div>
                    <div class="feature-title">æŒ‡æ•°é€€é¿</div>
                    <div class="feature-desc">é¿å…é›ªå´©æ•ˆåº”</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ›¡ï¸</div>
                    <div class="feature-title">ä¼˜é›…é™çº§</div>
                    <div class="feature-desc">å¤±è´¥æ—¶è¿”å›åŸå§‹æ–‡æœ¬</div>
                </div>
            </div>
        </section>

        <!-- Tech Stack Section -->
        <section id="techstack">
            <div class="section-header">
                <span class="section-icon">ğŸ› ï¸</span>
                <h2>æŠ€æœ¯æ ˆæ€»ç»“</h2>
            </div>

            <div class="tech-stack">
                <div class="tech-item">
                    <div class="tech-icon">ğŸŒ</div>
                    <div class="tech-name">Django 6.0</div>
                    <div class="tech-desc">Web æ¡†æ¶</div>
                </div>
                <div class="tech-item">
                    <div class="tech-icon">ğŸ</div>
                    <div class="tech-name">Python 3.x</div>
                    <div class="tech-desc">ç¼–ç¨‹è¯­è¨€</div>
                </div>
                <div class="tech-item">
                    <div class="tech-icon">ğŸ“„</div>
                    <div class="tech-name">python-docx</div>
                    <div class="tech-desc">Word æ–‡æ¡£å¤„ç†</div>
                </div>
                <div class="tech-item">
                    <div class="tech-icon">ğŸ¤–</div>
                    <div class="tech-name">ZhipuAI SDK</div>
                    <div class="tech-desc">æ™ºè°± AI é›†æˆ</div>
                </div>
                <div class="tech-item">
                    <div class="tech-icon">ğŸ’¾</div>
                    <div class="tech-name">SQLite</div>
                    <div class="tech-desc">å¼€å‘ç¯å¢ƒæ•°æ®åº“</div>
                </div>
                <div class="tech-item">
                    <div class="tech-icon">ğŸŒ</div>
                    <div class="tech-name">httpx/requests</div>
                    <div class="tech-desc">HTTP å®¢æˆ·ç«¯</div>
                </div>
            </div>
        </section>

        <footer>
            <p><strong>Format Specifications System</strong></p>
            <p style="margin-top: 0.5rem;">AI-Powered Word Document Formatting & Template Generation</p>
            <p style="margin-top: 1rem; font-size: 0.875rem;">
                ç‰ˆæœ¬: 1.0 | æ›´æ–°: 2026-01-20 | ç»´æŠ¤å›¢é˜Ÿ: Format Specifications Development Team
            </p>
        </footer>
    </div>

    <!-- Scroll to top button -->
    <button class="scroll-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
        â†‘
    </button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script>
        // Show/hide scroll to top button
        const scrollTopBtn = document.querySelector('.scroll-top');

        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                scrollTopBtn.classList.add('visible');
            } else {
                scrollTopBtn.classList.remove('visible');
            }
        });

        // Smooth scroll for navigation links
        document.querySelectorAll('nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Animate sections on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        document.querySelectorAll('section').forEach(section => {
            section.style.opacity = '0';
            section.style.transform = 'translateY(20px)';
            section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            observer.observe(section);
        });
    </script>
</body>
</html>
